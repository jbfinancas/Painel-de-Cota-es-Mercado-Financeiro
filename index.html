<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Financeiro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
}

h1 {
  text-align: center;
  padding: 20px;
}

.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  padding: 20px;
}

.card {
  background: #1e293b;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  transition: 0.3s;
}

.card:hover {
  transform: scale(1.03);
}

.green { color: #22c55e; }
.red { color: #ef4444; }

canvas {
  background: #1e293b;
  margin: 20px;
  border-radius: 10px;
}
</style>
</head>

<body>

<h1>Painel de Mercado</h1>

<div class="container" id="market"></div>

<canvas id="chart" height="100"></canvas>

<script>

let chart;

async function fetchData() {

  const response = await fetch("/api/quotes");
  const data = await response.json();

  const container = document.getElementById("market");
  container.innerHTML = "";

  const labels = [];
  const prices = [];

  Object.values(data).forEach(asset => {

    if (!asset || asset.status === "error") return;

    const percent = parseFloat(asset.percent_change) || 0;
    const price = parseFloat(asset.close) || 0;
    const color = percent >= 0 ? "green" : "red";

    labels.push(asset.symbol);
    prices.push(price);

    container.innerHTML += `
      <div class="card">
        <h3>${asset.symbol}</h3>
        <p>${price}</p>
        <p class="${color}">${percent.toFixed(2)}%</p>
      </div>
    `;
  });

  updateChart(labels, prices);
}

function updateChart(labels, prices) {

  if (chart) {
    chart.data.labels = labels;
    chart.data.datasets[0].data = prices;
    chart.update();
    return;
  }

  const ctx = document.getElementById("chart").getContext("2d");

  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "Pre√ßos Atuais",
        data: prices
      }]
    }
  });
}

fetchData();
setInterval(fetchData, 60000);

</script>

</body>
</html>